{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///(webpack)/buildin/harmony-module.js","webpack:///./src/auth/index.js","webpack:///./src/auth/router.js","webpack:///./src/auth/store.js","webpack:///./src/index.js","webpack:///./src/note/index.js","webpack:///./src/note/router.js","webpack:///./src/note/store.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///./src/utils/wsBroadcast.js","webpack:///external \"@koa/cors\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\"","webpack:///external \"ws\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","userStore","insert","body","token","status","err","issue","error","message","post","ctx","request","credentials","findOne","password","UserStore","constructor","filename","autoload","store","dataStore","props","app","Koa","use","cors","timingLogger","exceptionHandler","bodyParser","prefix","publicApiRouter","authRouter","routes","allowedMethods","protectedApiRouter","noteRouter","module","parent","listen","console","log","get","noteStore","find","state","note","params","id","book","item","put","noteId","updatedCount","update","newItems","del","rez","remove","NoteStore","noteTitle","title","Error","noteAuthor","author","noteGene","gene","next","start","Date","now","method","url","wss","init","server","WebSocket","Server","on","ws","JSON","parse","signInfo","verify","userId","e","close","broadcast","event","payload","clients","forEach","readyState","OPEN","send","stringify"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","module.exports = function(originalModule) {\r\n\tif (!originalModule.webpackPolyfill) {\r\n\t\tvar module = Object.create(originalModule);\r\n\t\t// module.parent = undefined by default\r\n\t\tif (!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"exports\", {\r\n\t\t\tenumerable: true\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n","export * from './router';","import Router from 'koa-router';\r\nimport userStore from './store';\r\nimport jwt from 'jsonwebtoken';\r\nimport { jwtConfig } from '../utils';\r\n\r\nexport const router = new Router();\r\n\r\nconst createToken = (user) => {\r\n  return jwt.sign({ username: user.username, _id: user._id }, jwtConfig.secret, { expiresIn: 60 * 60 * 60 });\r\n};\r\n\r\nconst createUser = async (user, response) => {\r\n  try {\r\n    await userStore.insert(user);\r\n    response.body = { token: createToken(user) };\r\n    response.status = 201; // created\r\n  } catch (err) {\r\n    response.body = { issue: [{ error: err.message }] };\r\n    response.status = 400; // bad request\r\n  }\r\n};\r\n\r\nrouter.post('/signup', async (ctx) => await createUser(ctx.request.body, ctx.response));\r\n\r\nrouter.post('/login', async (ctx) => {\r\n  const credentials = ctx.request.body;\r\n  const response = ctx.response;\r\n  const user = await userStore.findOne({ username: credentials.username });\r\n  if (user && credentials.password === user.password) {\r\n    response.body = { token: createToken(user) };\r\n    response.status = 201; // created\r\n  } else {\r\n    response.body = { issue: [{ error: 'Invalid credentials' }] };\r\n    response.status = 400; // bad request\r\n  }\r\n});\r\n","import dataStore from 'nedb-promise';\r\n\r\nexport class UserStore {\r\n  constructor({ filename, autoload }) {\r\n    this.store = dataStore({ filename, autoload });\r\n  }\r\n  \r\n  async findOne(props) {\r\n    return this.store.findOne(props);\r\n  }\r\n  \r\n  async insert(user) {\r\n    //\r\n    return this.store.insert(user);\r\n  };\r\n}\r\n\r\nexport default new UserStore({ filename: './db/users.json', autoload: true });","import Koa from 'koa';\r\nimport Router from 'koa-router';\r\nimport bodyParser from \"koa-bodyparser\";\r\nimport { timingLogger, exceptionHandler, jwtConfig } from './utils';\r\nimport { router as noteRouter } from './note';\r\nimport { router as authRouter } from './auth';\r\nimport jwt from 'koa-jwt';\r\nimport cors from '@koa/cors';\r\nimport {init} from \"./utils/wsBroadcast\";\r\n\r\n// const app = new Koa();\r\n// const server = require('http').createServer(app.callback());\r\n//\r\n// app.use(cors());\r\n//\r\n// init(server);\r\n//\r\n// app.use(timingLogger);\r\n// app.use(exceptionHandler);\r\n// app.use(bodyParser());\r\n\r\nconst app = new Koa();\r\n\r\napp.use(cors());\r\napp.use(timingLogger);\r\napp.use(exceptionHandler);\r\napp.use(bodyParser());\r\n\r\nconst prefix = '/api';\r\n\r\n// public\r\nconst publicApiRouter = new Router({ prefix });\r\npublicApiRouter\r\n  .use('/auth', authRouter.routes());\r\napp\r\n  .use(publicApiRouter.routes())\r\n  .use(publicApiRouter.allowedMethods());\r\n\r\n app.use(jwt(jwtConfig));\r\n\r\n\r\n// protected\r\nconst protectedApiRouter = new Router({ prefix });\r\nprotectedApiRouter\r\n    .use('/book', noteRouter.routes());\r\napp\r\n    .use(protectedApiRouter.routes())\r\n    .use(protectedApiRouter.allowedMethods());\r\n\r\n\r\nif (!module.parent) {\r\n  app.listen(3000);\r\n  console.log('started on port 3000');\r\n}\r\n","export * from './router';","import Router from 'koa-router';\r\nimport noteStore from './store';\r\nimport {broadcast} from \"../utils/wsBroadcast\";\r\n\r\nexport const router = new Router();\r\n\r\nrouter.get('/', async (ctx) => {\r\n    const response = ctx.response;\r\n    response.body = await noteStore.find({user: ctx.state.user.username});\r\n    response.status = 200; // ok\r\n});\r\n\r\nrouter.get('/:id', async (ctx) => {\r\n    const note = await noteStore.findOne({_id: ctx.params.id});\r\n    const response = ctx.response;\r\n    if (note) {\r\n        response.body = note;\r\n        response.status = 200; // ok\r\n    } else {\r\n        response.status = 404; // not found\r\n    }\r\n});\r\n\r\n\r\nrouter.post('/', async (ctx) => {\r\n    const book = ctx.request.body;\r\n\tif(book.user === \"user\"){\r\n\t\tbook.user = ctx.state.user.username\r\n\t}\r\n    const response = ctx.response;\r\n\r\n    try {\r\n        console.log(book);\r\n        const item = await noteStore.insert(book);\r\n        response.body = item;\r\n        response.status = 201; // created\r\n        // broadcast({event: 'created', payload: item});\r\n    } catch (err) {\r\n        response.body = {issue: [{error: err.message}]};\r\n        response.status = 400; // bad request\r\n    }\r\n});\r\n\r\nrouter.put('/', async (ctx) => {\r\n    const note = ctx.request.body;\r\n\t\tif(note.user === \"user\"){\r\n\t\tnote.user = ctx.state.user.username\r\n\t}\r\n    const noteId = note._id;\r\n    const response = ctx.response;\r\n    if (noteId) {\r\n        const updatedCount = await noteStore.update({_id: noteId}, note);\r\n        if (updatedCount === 1) {\r\n            const newItems = await noteStore.find({_id: noteId});\r\n            const item = newItems[0];\r\n            response.body = item;\r\n            response.status = 200; // ok\r\n            // broadcast({event: 'updated', payload: item});\r\n        } else {\r\n            response.body = {issue: [{error: 'Resource no longer exists'}]};\r\n            response.status = 405; // method not allowed\r\n        }\r\n    }\r\n    if (!noteId) {\r\n        response.body = {issue: [{error: 'Body id is not defined'}]};\r\n        response.status = 400; // bad request\r\n    }\r\n});\r\n\r\nrouter.del('/:id', async (ctx) => {\r\n    const rez = await noteStore.remove({_id: ctx.params.id});\r\n    if (rez == 1) {\r\n        ctx.response.status = 200; // success\r\n        ctx.response.body = true;\r\n        // broadcast({event: 'deleted', payload: payload});\r\n    } else {\r\n        ctx.response.status = 400; // bad request\r\n        ctx.response.body = false\r\n    }\r\n\r\n});\r\n","import dataStore from 'nedb-promise';\r\n\r\nexport class NoteStore {\r\n  constructor({ filename, autoload }) {\r\n    this.store = dataStore({ filename, autoload });\r\n  }\r\n  \r\n  async find(props) {\r\n    return this.store.find(props);\r\n  }\r\n  \r\n  async findOne(props) {\r\n    return this.store.findOne(props);\r\n  }\r\n  \r\n  async insert(note) {\r\n    let noteTitle = note.title;\r\n    if (!noteTitle) { // validation\r\n      throw new Error('Missing title property')\r\n    }\r\n\r\n    let noteAuthor = note.author;\r\n    if (!noteAuthor) { // validation\r\n      throw new Error('Missing author property')\r\n    }\r\n\r\n    let noteGene = note.gene;\r\n    if (!noteGene) { // validation\r\n      throw new Error('Missing gene property')\r\n    }\r\n\r\n    return this.store.insert(note);\r\n  };\r\n  \r\n  async update(props, note) {\r\n    return this.store.update(props, note);\r\n  }\r\n  \r\n  async remove(props) {\r\n    return this.store.remove(props);\r\n  }\r\n}\r\n\r\nexport default new NoteStore({ filename: './db/books.json', autoload: true });\r\n","export const jwtConfig = { secret: 'my-secret' };\r\n","export * from './middlewares';\r\nexport * from './constants';\r\n","export const exceptionHandler = async (ctx, next) => {\r\n  try {\r\n    return await next();\r\n  } catch (err) {\r\n    ctx.body = { message: err.message || 'Unexpected error.' };\r\n    ctx.status = err.status || 500;\r\n  }\r\n};\r\n\r\nexport const timingLogger = async (ctx, next) => {\r\n  const start = Date.now();\r\n  await next();\r\n  console.log(`${ctx.method} ${ctx.url} => ${ctx.response.status}, ${Date.now() - start}ms`);\r\n  console.log(ctx.response.body);\r\n};\r\n","import WebSocket from \"ws\";\r\nimport jwt from 'jsonwebtoken';\r\nimport {jwtConfig} from \"./constants\";\r\n\r\nlet wss;\r\n\r\nexport const init = server => {\r\n    wss = new WebSocket.Server({server});\r\n\r\n    wss.on('connection', ws => {\r\n        ws.on('message', message => {\r\n            console.log('received: %s', message);\r\n            const {token} = JSON.parse(message);\r\n            try {\r\n                const signInfo = jwt.verify(token, jwtConfig.secret);\r\n                ws.user = {userId: signInfo._id};\r\n            } catch (e) {\r\n                ws.close();\r\n                console.log('Connection closed!!!!');\r\n            }\r\n        });\r\n\r\n    });\r\n};\r\n\r\nexport const broadcast = ({event, payload}) => {\r\n    wss.clients.forEach(ws => {\r\n        if (ws.readyState === WebSocket.OPEN) {\r\n            const userId = ws.user ? ws.user.userId : null;\r\n            if (ws.readyState === WebSocket.OPEN && userId === payload.userId) {\r\n                ws.send(JSON.stringify({event, payload}));\r\n            }\r\n        }\r\n    });\r\n};\r\n","module.exports = require(\"@koa/cors\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");","module.exports = require(\"ws\");"],"sourceRoot":""}